<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PBL Game â€” Start Your Journey</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Syne:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root {
    --line1: #F37E4C;
    --line2: #795CDC;
    --line3: #3C7C54;
    --green: #4EA72E;
    --bg: #F5F0E8;
    --dark: #1A1A2E;
    --card-bg: #FFFFFF;
    --station-size: 14px;
    --track: 4px;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Syne', sans-serif;
    background: var(--bg);
    color: var(--dark);
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* â”€â”€ SCREENS â”€â”€ */
  .screen { display: none; min-height: 100vh; }
  .screen.active { display: flex; flex-direction: column; }

  /* â”€â”€ INTRO SCREEN â”€â”€ */
  #screen-intro {
    align-items: center;
    justify-content: center;
    background: var(--dark);
    position: relative;
    overflow: hidden;
  }

  #screen-intro::before {
    content: '';
    position: absolute;
    inset: 0;
    background: 
      radial-gradient(circle at 20% 50%, rgba(243,126,76,0.15) 0%, transparent 50%),
      radial-gradient(circle at 80% 30%, rgba(121,92,220,0.15) 0%, transparent 50%),
      radial-gradient(circle at 50% 80%, rgba(60,124,84,0.15) 0%, transparent 50%);
  }

  .intro-content {
    text-align: center;
    position: relative;
    z-index: 1;
    padding: 40px;
  }

  .intro-tag {
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    letter-spacing: 4px;
    color: var(--green);
    text-transform: uppercase;
    margin-bottom: 20px;
    opacity: 0;
    animation: fadeUp 0.6s ease forwards 0.2s;
  }

  .intro-title {
    font-size: clamp(56px, 10vw, 100px);
    font-weight: 800;
    color: #fff;
    line-height: 0.9;
    letter-spacing: -3px;
    margin-bottom: 8px;
    opacity: 0;
    animation: fadeUp 0.6s ease forwards 0.4s;
  }

  .intro-title span {
    display: block;
    font-size: clamp(24px, 4vw, 40px);
    font-weight: 400;
    letter-spacing: 2px;
    color: rgba(255,255,255,0.5);
    margin-top: 10px;
  }

  .intro-subtitle {
    font-family: 'Space Mono', monospace;
    font-size: 13px;
    color: rgba(255,255,255,0.4);
    margin: 32px 0 48px;
    line-height: 1.8;
    opacity: 0;
    animation: fadeUp 0.6s ease forwards 0.6s;
  }

  .line-pills {
    display: flex;
    gap: 12px;
    justify-content: center;
    margin-bottom: 48px;
    opacity: 0;
    animation: fadeUp 0.6s ease forwards 0.8s;
  }

  .pill {
    padding: 6px 16px;
    border-radius: 100px;
    font-size: 11px;
    font-weight: 700;
    letter-spacing: 1px;
    text-transform: uppercase;
    color: white;
  }
  .pill-1 { background: var(--line1); }
  .pill-2 { background: var(--line2); }
  .pill-3 { background: var(--line3); }

  .btn-start {
    background: var(--green);
    color: white;
    border: none;
    padding: 18px 52px;
    font-family: 'Syne', sans-serif;
    font-size: 16px;
    font-weight: 700;
    letter-spacing: 2px;
    text-transform: uppercase;
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.2s;
    opacity: 0;
    animation: fadeUp 0.6s ease forwards 1s;
    position: relative;
    overflow: hidden;
  }

  .btn-start::after {
    content: '';
    position: absolute;
    inset: 0;
    background: rgba(255,255,255,0.1);
    transform: translateX(-100%);
    transition: transform 0.3s ease;
  }

  .btn-start:hover::after { transform: translateX(0); }
  .btn-start:hover { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(78,167,46,0.4); }

  /* â”€â”€ SETUP SCREEN â”€â”€ */
  #screen-setup {
    align-items: center;
    justify-content: center;
    padding: 40px 20px;
    background: var(--bg);
  }

  .setup-box {
    background: white;
    border-radius: 16px;
    padding: 48px;
    max-width: 540px;
    width: 100%;
    box-shadow: 0 4px 40px rgba(0,0,0,0.08);
  }

  .setup-box h2 {
    font-size: 28px;
    font-weight: 800;
    margin-bottom: 8px;
  }

  .setup-box p {
    font-family: 'Space Mono', monospace;
    font-size: 12px;
    color: rgba(0,0,0,0.4);
    margin-bottom: 36px;
  }

  .team-input-group { margin-bottom: 20px; }

  .team-input-group label {
    display: block;
    font-size: 12px;
    font-weight: 700;
    letter-spacing: 2px;
    text-transform: uppercase;
    margin-bottom: 8px;
    color: rgba(0,0,0,0.5);
  }

  .team-input-group input {
    width: 100%;
    padding: 14px 16px;
    border: 2px solid #E8E8E8;
    border-radius: 8px;
    font-family: 'Syne', sans-serif;
    font-size: 16px;
    font-weight: 600;
    outline: none;
    transition: border-color 0.2s;
  }

  .team-input-group input:focus { border-color: var(--green); }

  #teams-container { margin-bottom: 28px; }

  .btn-add-team {
    background: none;
    border: 2px dashed #ccc;
    border-radius: 8px;
    padding: 12px;
    width: 100%;
    font-family: 'Syne', sans-serif;
    font-size: 14px;
    color: #999;
    cursor: pointer;
    transition: all 0.2s;
    margin-bottom: 28px;
  }

  .btn-add-team:hover { border-color: var(--green); color: var(--green); }

  .btn-primary {
    background: var(--dark);
    color: white;
    border: none;
    padding: 16px 32px;
    font-family: 'Syne', sans-serif;
    font-size: 15px;
    font-weight: 700;
    letter-spacing: 1px;
    border-radius: 8px;
    cursor: pointer;
    width: 100%;
    transition: all 0.2s;
  }

  .btn-primary:hover { background: var(--green); transform: translateY(-1px); }

  /* â”€â”€ GAME SCREEN â”€â”€ */
  #screen-game {
    flex-direction: row;
    height: 100vh;
    overflow: hidden;
  }

  /* SIDEBAR */
  .sidebar {
    width: 220px;
    min-width: 220px;
    background: var(--dark);
    color: white;
    padding: 24px 16px;
    display: flex;
    flex-direction: column;
    gap: 8px;
    overflow-y: auto;
  }

  .sidebar-logo {
    font-size: 18px;
    font-weight: 800;
    letter-spacing: -1px;
    margin-bottom: 16px;
    padding-bottom: 16px;
    border-bottom: 1px solid rgba(255,255,255,0.1);
  }

  .sidebar-logo span {
    display: block;
    font-family: 'Space Mono', monospace;
    font-size: 9px;
    font-weight: 400;
    letter-spacing: 3px;
    color: rgba(255,255,255,0.4);
    margin-top: 2px;
  }

  .sidebar-section {
    font-family: 'Space Mono', monospace;
    font-size: 9px;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: rgba(255,255,255,0.3);
    padding: 12px 8px 4px;
  }

  .team-chip {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 12px;
    border-radius: 8px;
    cursor: pointer;
    transition: background 0.15s;
    position: relative;
  }

  .team-chip:hover { background: rgba(255,255,255,0.05); }
  .team-chip.active { background: rgba(255,255,255,0.1); }

  .team-dot {
    width: 10px; height: 10px;
    border-radius: 50%;
    flex-shrink: 0;
  }

  .team-chip-name {
    font-size: 13px;
    font-weight: 600;
    flex: 1;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .team-chip-pos {
    font-family: 'Space Mono', monospace;
    font-size: 10px;
    color: rgba(255,255,255,0.4);
  }

  .sidebar-turn-btn {
    margin-top: auto;
    background: var(--green);
    color: white;
    border: none;
    padding: 14px;
    border-radius: 8px;
    font-family: 'Syne', sans-serif;
    font-size: 13px;
    font-weight: 700;
    letter-spacing: 1px;
    cursor: pointer;
    transition: all 0.2s;
    text-align: center;
  }

  .sidebar-turn-btn:hover { filter: brightness(1.1); }

  /* MAIN BOARD */
  .board-area {
    flex: 1;
    overflow: hidden;
    position: relative;
    background: var(--bg);
  }

  .board-header {
    position: absolute;
    top: 0; left: 0; right: 0;
    padding: 16px 24px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    z-index: 10;
    background: linear-gradient(to bottom, var(--bg) 70%, transparent);
  }

  .current-turn {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .turn-label {
    font-family: 'Space Mono', monospace;
    font-size: 10px;
    letter-spacing: 2px;
    color: rgba(0,0,0,0.4);
    text-transform: uppercase;
  }

  .turn-name {
    font-size: 16px;
    font-weight: 800;
  }

  .turn-dot {
    width: 12px; height: 12px;
    border-radius: 50%;
  }

  .line-legend {
    display: flex;
    gap: 16px;
  }

  .legend-item {
    display: flex;
    align-items: center;
    gap: 6px;
    font-family: 'Space Mono', monospace;
    font-size: 10px;
    font-weight: 700;
    letter-spacing: 1px;
  }

  .legend-dot {
    width: 10px; height: 10px;
    border-radius: 50%;
  }

  /* SVG BOARD */
  #board-svg {
    width: 100%;
    height: 100%;
  }

  /* STATION styles in SVG are inline */

  /* â”€â”€ CARD MODAL â”€â”€ */
  .modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.7);
    backdrop-filter: blur(4px);
    z-index: 100;
    display: none;
    align-items: center;
    justify-content: center;
    padding: 20px;
  }

  .modal-overlay.open { display: flex; }

  .card {
    background: white;
    border-radius: 20px;
    max-width: 500px;
    width: 100%;
    overflow: hidden;
    box-shadow: 0 32px 80px rgba(0,0,0,0.3);
    animation: cardIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
  }

  @keyframes cardIn {
    from { transform: scale(0.85) translateY(20px); opacity: 0; }
    to { transform: scale(1) translateY(0); opacity: 1; }
  }

  .card-header {
    padding: 24px 28px 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .card-line-tag {
    font-family: 'Space Mono', monospace;
    font-size: 10px;
    letter-spacing: 3px;
    text-transform: uppercase;
    font-weight: 700;
    color: white;
    padding: 4px 12px;
    border-radius: 100px;
  }

  .card-station-label {
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    color: rgba(0,0,0,0.35);
    letter-spacing: 1px;
  }

  .card-body {
    padding: 0 28px 28px;
  }

  .card-question {
    font-size: 22px;
    font-weight: 700;
    line-height: 1.35;
    margin-bottom: 20px;
    color: var(--dark);
  }

  .card-divider {
    height: 1px;
    background: #F0F0F0;
    margin-bottom: 20px;
  }

  .card-concept-label {
    font-family: 'Space Mono', monospace;
    font-size: 9px;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: rgba(0,0,0,0.35);
    margin-bottom: 6px;
  }

  .card-concept {
    font-size: 14px;
    font-weight: 600;
    padding: 10px 14px;
    border-radius: 8px;
    display: inline-block;
    margin-bottom: 20px;
  }

  .card-goal-label {
    font-family: 'Space Mono', monospace;
    font-size: 9px;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: rgba(0,0,0,0.35);
    margin-bottom: 6px;
  }

  .card-goal {
    font-size: 13px;
    line-height: 1.6;
    color: rgba(0,0,0,0.6);
    margin-bottom: 28px;
  }

  .card-actions {
    display: flex;
    gap: 10px;
  }

  .btn-close-card {
    flex: 1;
    padding: 14px;
    border: 2px solid #E8E8E8;
    background: none;
    border-radius: 10px;
    font-family: 'Syne', sans-serif;
    font-size: 13px;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.2s;
  }

  .btn-close-card:hover { border-color: #ccc; }

  .btn-done-card {
    flex: 2;
    padding: 14px;
    border: none;
    border-radius: 10px;
    font-family: 'Syne', sans-serif;
    font-size: 13px;
    font-weight: 700;
    color: white;
    cursor: pointer;
    transition: all 0.2s;
  }

  .btn-done-card:hover { filter: brightness(1.1); transform: translateY(-1px); }

  /* â”€â”€ TOAST â”€â”€ */
  .toast {
    position: fixed;
    bottom: 32px;
    left: 50%;
    transform: translateX(-50%) translateY(80px);
    background: var(--dark);
    color: white;
    padding: 14px 28px;
    border-radius: 100px;
    font-size: 13px;
    font-weight: 600;
    z-index: 200;
    transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    white-space: nowrap;
  }

  .toast.show { transform: translateX(-50%) translateY(0); }

  /* â”€â”€ WINNER SCREEN â”€â”€ */
  #screen-winner {
    align-items: center;
    justify-content: center;
    background: var(--dark);
    text-align: center;
    padding: 40px;
  }

  .winner-emoji { font-size: 80px; margin-bottom: 24px; animation: bounce 1s ease infinite alternate; }

  @keyframes bounce {
    from { transform: translateY(0); }
    to { transform: translateY(-12px); }
  }

  .winner-title {
    font-size: clamp(40px, 8vw, 72px);
    font-weight: 800;
    color: white;
    letter-spacing: -2px;
    margin-bottom: 8px;
  }

  .winner-name {
    font-size: clamp(24px, 5vw, 48px);
    font-weight: 800;
    margin-bottom: 32px;
  }

  .btn-restart {
    background: var(--green);
    color: white;
    border: none;
    padding: 16px 40px;
    border-radius: 8px;
    font-family: 'Syne', sans-serif;
    font-size: 15px;
    font-weight: 700;
    cursor: pointer;
    letter-spacing: 1px;
    transition: all 0.2s;
  }

  .btn-restart:hover { filter: brightness(1.1); transform: translateY(-2px); }

  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(16px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* Responsive */
  @media (max-width: 768px) {
    #screen-game { flex-direction: column; }
    .sidebar { width: 100%; min-width: unset; flex-direction: row; flex-wrap: wrap; height: auto; overflow-x: auto; padding: 12px; }
    .sidebar-logo { display: none; }
    .sidebar-section { display: none; }
    .sidebar-turn-btn { margin-top: 0; }
    .board-area { flex: 1; }
  }
</style>
</head>
<body>

<!-- INTRO -->
<div id="screen-intro" class="screen active">
  <div class="intro-content">
    <div class="intro-tag">IT:U Interdisciplinary University</div>
    <div class="intro-title">PBL<span>GAME</span></div>
    <div class="intro-subtitle">
      A learning journey for teams<br>
      Choose your line Â· Draw a card Â· Start a conversation
    </div>
    <div class="line-pills">
      <div class="pill pill-1">LINE 1 Â· Know Each Other</div>
      <div class="pill pill-2">LINE 2 Â· Individual Learning</div>
      <div class="pill pill-3">LINE 3 Â· Team Learning</div>
    </div>
    <button class="btn-start" onclick="showScreen('setup')">Start Your Journey â†’</button>
  </div>
</div>

<!-- SETUP -->
<div id="screen-setup" class="screen">
  <div class="setup-box">
    <h2>Set Up Teams</h2>
    <p>Add the teams playing today</p>
    <div id="teams-container"></div>
    <button class="btn-add-team" onclick="addTeamInput()">+ Add another team</button>
    <button class="btn-primary" onclick="startGame()">Launch Game â†’</button>
  </div>
</div>

<!-- GAME -->
<div id="screen-game" class="screen">
  <div class="sidebar">
    <div class="sidebar-logo">PBL Game<span>Start Your Journey</span></div>
    <div class="sidebar-section">Teams</div>
    <div id="teams-list"></div>
    <button class="sidebar-turn-btn" onclick="nextTurn()">End Turn â†’</button>
  </div>
  <div class="board-area">
    <div class="board-header">
      <div class="current-turn">
        <div class="turn-dot" id="turn-dot"></div>
        <div>
          <div class="turn-label">Current Turn</div>
          <div class="turn-name" id="turn-name">â€”</div>
        </div>
      </div>
      <div class="line-legend">
        <div class="legend-item"><div class="legend-dot" style="background:var(--line1)"></div>LINE 1</div>
        <div class="legend-item"><div class="legend-dot" style="background:var(--line2)"></div>LINE 2</div>
        <div class="legend-item"><div class="legend-dot" style="background:var(--line3)"></div>LINE 3</div>
      </div>
    </div>
    <svg id="board-svg" viewBox="0 0 800 600" preserveAspectRatio="xMidYMid meet"></svg>
  </div>
</div>

<!-- WINNER -->
<div id="screen-winner" class="screen">
  <div class="winner-emoji">ðŸŽ‰</div>
  <div class="winner-title">Journey Complete!</div>
  <div class="winner-name" id="winner-name" style="color: var(--green)"></div>
  <p style="color:rgba(255,255,255,0.4); font-family:'Space Mono',monospace; font-size:12px; margin-bottom:40px">has visited all stations</p>
  <button class="btn-restart" onclick="showScreen('intro')">Play Again</button>
</div>

<!-- CARD MODAL -->
<div class="modal-overlay" id="card-modal">
  <div class="card">
    <div class="card-header">
      <div class="card-line-tag" id="modal-line-tag"></div>
      <div class="card-station-label" id="modal-station-label"></div>
    </div>
    <div class="card-body">
      <div class="card-question" id="modal-question"></div>
      <div class="card-divider"></div>
      <div class="card-concept-label">Key Concept</div>
      <div class="card-concept" id="modal-concept"></div>
      <div class="card-goal-label">Goal</div>
      <div class="card-goal" id="modal-goal"></div>
      <div class="card-actions">
        <button class="btn-close-card" onclick="closeCard()">Skip</button>
        <button class="btn-done-card" id="modal-done-btn" onclick="completeStation()">Answered! âœ“</button>
      </div>
    </div>
  </div>
</div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<script>
// â”€â”€ DATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const LINES = {
  1: { name: 'Get to Know Each Other', color: '#F37E4C', label: 'LINE 1' },
  2: { name: 'Individual Learning',    color: '#795CDC', label: 'LINE 2' },
  3: { name: 'Team Learning',          color: '#3C7C54', label: 'LINE 3' }
};

const CARDS = {
  1: [
    { q: 'Introduce yourself to the group.', concept: 'Psychological Safety & Belonging', goal: 'Build connections â€” helps participants get to know each other' },
    { q: 'What is your research or academic background?', concept: 'Interdisciplinary Awareness & Identity', goal: 'Understand backgrounds â€” provides insight into each person\'s expertise' },
    { q: 'What motivated you to enter your discipline? Was it planned or a happy accident?', concept: 'Interdisciplinary Awareness & Identity', goal: 'Explore motivations â€” shares personal stories behind career choices' },
    { q: 'What\'s one thing about your field that you wish more people understood?', concept: 'Interdisciplinary Awareness & Identity', goal: 'Promote awareness â€” highlights key insights from different fields' },
    { q: 'If you had to explain your field to a child in one sentence, how would you do it?', concept: 'Interdisciplinary Awareness & Identity', goal: 'Simplify complexity â€” encourages clear and accessible communication' },
    { q: 'What\'s a skill or knowledge area from another discipline you wish you had or admire?', concept: 'Interdisciplinary Awareness & Identity', goal: 'Foster interdisciplinary appreciation â€” recognizes valuable skills from other disciplines' },
    { q: 'What\'s the most exciting interdisciplinary project you\'ve worked on?', concept: 'Authentic & Experiential Learning', goal: 'Encourage collaboration â€” shares experiences of working across disciplines' },
    { q: 'What motivated you to change your discipline and join IT:U?', concept: 'Psychological Safety & Belonging', goal: 'Motivation for IT:U, working interdisciplinarily' },
    { q: 'What\'s a skill from your discipline that you are proud of and bring to the table?', concept: 'Interdisciplinary Awareness & Identity', goal: 'Interdisciplinary appreciation â€” recognizing benefits due to complementarity' },
  ],
  2: [
    { q: 'What strategies do you use to stay motivated when learning something new?', concept: 'Self-Regulated Learning (SRL)', goal: 'Understand motivation â€” identifies what drives individuals to stay engaged' },
    { q: 'How do you plan and manage your time when preparing for a big project or deadline?', concept: 'Self-Regulated Learning (SRL)', goal: 'Explore time management â€” reveals strategies for organizing work efficiently' },
    { q: 'When you get stuck on a difficult problem or concept, what do you usually do?', concept: 'Self-Regulated Learning (SRL)', goal: 'Assess problem-solving approaches â€” uncovers strategies for overcoming learning obstacles' },
    { q: 'Can you think of a time when you adjusted your study methods to improve your learning? What was the trigger?', concept: 'Metacognition & Reflection', goal: 'Encourage reflection on learning adaptation â€” highlights self-awareness and ability to refine learning techniques' },
    { q: 'How do you adapt your learning approach when faced with a subject that doesn\'t come naturally?', concept: 'Self-Regulated Learning (SRL)', goal: 'Analyze learning flexibility â€” examines how individuals adjust their approach to challenging topics' },
    { q: 'How do you usually learn from teammates who have a different approach or background?', concept: 'Co-Regulation & Peer Learning', goal: 'Bridge individual learning to team learning â€” connects personal learning style to collaborative PBL context' },
    { q: 'When managing multiple projects or learning goals, how do you prioritize tasks while ensuring deep understanding?', concept: 'Self-Regulated Learning (SRL)', goal: 'Evaluate prioritization and deep learning strategies' },
    { q: 'How do you integrate feedback â€” from peers, mentors, or self-reflection â€” into your learning process?', concept: 'Co-Regulation & Peer Learning', goal: 'Highlight the role of feedback in growth â€” demonstrates how input influences learning and improvement' },
    { q: 'How do you usually coordinate team and individual goals? What are your strategies to coordinate vested interests?', concept: 'Socially Shared Regulated Learning (SSRL)', goal: 'Bridge individual learning to team learning â€” connects personal agendas to collaborative PBL context' },
    { q: 'What are your expectations for working interdisciplinarily? What strategies do you apply?', concept: 'Socially Shared Regulated Learning (SSRL)', goal: 'Interdisciplinary collaboration â€” experiences and strategies' },
    { q: 'What are your expectations for working, learning and innovating in teams?', concept: 'Socially Shared Regulated Learning (SSRL)', goal: 'Collaboration â€” experiences and strategies; socially shared regulated learning' },
  ],
  3: [
    { q: 'Have you ever worked on a project that required knowledge from multiple disciplines? How did combining perspectives impact your learning?', concept: 'Authentic & Experiential Learning', goal: 'Encourage interdisciplinary thinking â€” explores how integrating diverse knowledge enhances learning' },
    { q: 'How do you feel about using a digital portfolio to showcase your learning and projects?', concept: 'Metacognition & Reflection', goal: 'Assess reflection and presentation of learning â€” examines attitudes toward documenting experiences' },
    { q: 'PBL involves collaboration with industry and academia. What kinds of real-world projects would you be most excited to work on?', concept: 'Authentic & Experiential Learning', goal: 'Connect learning to real-world applications â€” identifies interests and motivations' },
    { q: 'Would you be open to sharing your work in a team and collaborating with a broader learning community? What would make you more willing?', concept: 'Psychological Safety & Belonging', goal: 'Explore openness to knowledge sharing â€” investigates willingness to engage in broader learning networks' },
    { q: 'Reflecting on a past project, what was the most valuable lesson â€” not just academically, but in terms of teamwork, communication, or adaptability?', concept: 'Transversal Skills Development', goal: 'Highlight personal and professional growth â€” encourages reflection on key skills gained beyond academics' },
    { q: 'What do you expect from a team PBL coach during a project? How would their support ideally look?', concept: 'Team Regulation & Collaboration Contract', goal: 'Align coaching expectations â€” surfaces mental models of coaching and prepares for the coach/facilitator role' },
    { q: 'Think of a time you worked in a team where things didn\'t go as planned. What ground rules or agreements could have helped?', concept: 'Team Regulation & Collaboration Contract', goal: 'Prepare for the Collaboration Contract â€” connects real experience to the need for explicit team agreements' },
    { q: 'When working in teams, how do you handle situations where someone is not contributing or there is unconstructive conflict?', concept: 'Team Regulation & Collaboration Contract', goal: 'Explore team regulation and conflict resolution â€” addresses teamwork dynamics' },
    { q: 'What tools have you used to manage projects or track team progress (e.g., Gantt charts, Kanban boards)?', concept: 'Project Management Literacy', goal: 'Map prior experience with PM tools â€” identifies baseline knowledge and prepares for Lucidchart and Gantt tools' },
    { q: 'Which transversal skills (e.g., teamwork, communication, adaptability, critical thinking) do you find most challenging to develop?', concept: 'Transversal Skills Development', goal: 'Identify transversal skill development priorities â€” helps coaches focus on specific skills' },
    { q: 'How do you think regular check-ins or structured meetings with a coach could support your team\'s learning process?', concept: 'Co-Regulation & Peer Learning', goal: 'Introduce coaching process/structure â€” opens discussion about recurring meeting structure' },
    { q: 'Have you ever participated in project-based learning or worked on an industry project? What are your experiences and lessons learned?', concept: 'Authentic & Experiential Learning', goal: 'PBL approach â€” experiences and strategies; active learning in teams' },
  ]
};

// â”€â”€ BOARD LAYOUT (metro-style) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Stations per line with SVG positions
const STATIONS = {
  1: [
    { id:'1-1', x:80,  y:480, label:'S1' },
    { id:'1-2', x:160, y:400, label:'S2' },
    { id:'1-3', x:160, y:300, label:'S3' },
    { id:'1-4', x:160, y:200, label:'S4' },
    { id:'1-5', x:240, y:130, label:'S5' },
    { id:'1-6', x:340, y:130, label:'S6' },
    { id:'1-7', x:440, y:130, label:'S7' },
    { id:'1-8', x:540, y:200, label:'S8' },
    { id:'1-9', x:540, y:300, label:'END', isEnd: true },
  ],
  2: [
    { id:'2-1', x:80,  y:300, label:'S1' },
    { id:'2-2', x:160, y:300, label:'S2', isJunction: true },
    { id:'2-3', x:240, y:300, label:'S3' },
    { id:'2-4', x:340, y:300, label:'S4' },
    { id:'2-5', x:440, y:300, label:'S5' },
    { id:'2-6', x:540, y:300, label:'S6', isJunction: true },
    { id:'2-7', x:640, y:300, label:'S7' },
    { id:'2-8', x:720, y:380, label:'S8' },
    { id:'2-9', x:720, y:460, label:'S9' },
    { id:'2-10',x:640, y:480, label:'S10'},
    { id:'2-11',x:540, y:480, label:'END', isEnd: true },
  ],
  3: [
    { id:'3-1', x:80,  y:120, label:'S1' },
    { id:'3-2', x:160, y:120, label:'S2' },
    { id:'3-3', x:240, y:120, label:'S3', isJunction: true },
    { id:'3-4', x:340, y:120, label:'S4' },
    { id:'3-5', x:440, y:120, label:'S5' },
    { id:'3-6', x:540, y:120, label:'S6' },
    { id:'3-7', x:640, y:120, label:'S7' },
    { id:'3-8', x:720, y:200, label:'S8' },
    { id:'3-9', x:720, y:300, label:'S9', isJunction: true },
    { id:'3-10',x:720, y:380, label:'S10', isJunction: true },
    { id:'3-11',x:640, y:460, label:'S11'},
    { id:'3-12',x:540, y:480, label:'END', isEnd: true },
  ]
};

// â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let teams = [];
let currentTeamIdx = 0;
let activeStation = null;
let activeCard = null;

const TEAM_COLORS = ['#E74C3C','#3498DB','#9B59B6','#E67E22','#1ABC9C','#F39C12'];

// â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showScreen(name) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById('screen-' + name).classList.add('active');
  if (name === 'setup') initSetup();
  if (name === 'game')  initBoard();
}

function initSetup() {
  const c = document.getElementById('teams-container');
  c.innerHTML = '';
  addTeamInput('Team Alpha');
  addTeamInput('Team Beta');
}

function addTeamInput(defaultVal = '') {
  const c = document.getElementById('teams-container');
  const idx = c.children.length;
  const div = document.createElement('div');
  div.className = 'team-input-group';
  div.innerHTML = `
    <label>Team ${idx + 1}</label>
    <input type="text" placeholder="Enter team name" value="${defaultVal}">
  `;
  c.appendChild(div);
}

function startGame() {
  const inputs = document.querySelectorAll('#teams-container input');
  teams = [];
  inputs.forEach((inp, i) => {
    const name = inp.value.trim() || `Team ${i+1}`;
    teams.push({
      name,
      color: TEAM_COLORS[i % TEAM_COLORS.length],
      positions: { 1: 0, 2: 0, 3: 0 },
      completed: { 1: [], 2: [], 3: [] },
      usedCards: { 1: [], 2: [], 3: [] },
      totalAnswered: 0,
      chosenLine: null
    });
  });
  currentTeamIdx = 0;
  showScreen('game');
}

// â”€â”€ BOARD RENDERING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function initBoard() {
  renderSidebar();
  renderBoard();
  updateTurnDisplay();
}

function renderSidebar() {
  const list = document.getElementById('teams-list');
  list.innerHTML = '';
  teams.forEach((team, i) => {
    const div = document.createElement('div');
    div.className = 'team-chip' + (i === currentTeamIdx ? ' active' : '');
    div.id = `team-chip-${i}`;
    const total = Object.values(team.completed).reduce((a, b) => a + b.length, 0);
    const max = Object.values(CARDS).reduce((a, b) => a + b.length, 0);
    div.innerHTML = `
      <div class="team-dot" style="background:${team.color}"></div>
      <div class="team-chip-name">${team.name}</div>
      <div class="team-chip-pos">${total}/${max}</div>
    `;
    list.appendChild(div);
  });
}

function renderBoard() {
  const svg = document.getElementById('board-svg');
  svg.innerHTML = '';

  const defs = document.createElementNS('http://www.w3.org/2000/svg','defs');
  // subtle grid background
  defs.innerHTML = `
    <pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse">
      <path d="M 40 0 L 0 0 0 40" fill="none" stroke="rgba(0,0,0,0.04)" stroke-width="1"/>
    </pattern>
    <filter id="glow">
      <feGaussianBlur stdDeviation="3" result="blur"/>
      <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
    </filter>
  `;
  svg.appendChild(defs);

  // Background
  const bg = document.createElementNS('http://www.w3.org/2000/svg','rect');
  bg.setAttribute('width','800'); bg.setAttribute('height','600');
  bg.setAttribute('fill','url(#grid)');
  svg.appendChild(bg);

  // Title
  const title = document.createElementNS('http://www.w3.org/2000/svg','text');
  title.setAttribute('x','400'); title.setAttribute('y','555');
  title.setAttribute('text-anchor','middle');
  title.setAttribute('font-family','Syne, sans-serif');
  title.setAttribute('font-size','11');
  title.setAttribute('font-weight','700');
  title.setAttribute('letter-spacing','4');
  title.setAttribute('fill','rgba(0,0,0,0.15)');
  title.textContent = 'PBL GAME Â· START YOUR JOURNEY';
  svg.appendChild(title);

  // Draw each line's track
  [1, 2, 3].forEach(line => {
    const stns = STATIONS[line];
    const color = LINES[line].color;

    // Track path
    const pts = stns.map(s => `${s.x},${s.y}`).join(' ');
    const path = document.createElementNS('http://www.w3.org/2000/svg','polyline');
    path.setAttribute('points', pts);
    path.setAttribute('fill','none');
    path.setAttribute('stroke', color);
    path.setAttribute('stroke-width','4');
    path.setAttribute('stroke-linecap','round');
    path.setAttribute('stroke-linejoin','round');
    path.setAttribute('opacity','0.7');
    svg.appendChild(path);
  });

  // Draw stations
  [1, 2, 3].forEach(line => {
    const stns = STATIONS[line];
    const color = LINES[line].color;
    const cards = CARDS[line];

    stns.forEach((stn, idx) => {
      const cardIdx = idx; // each station maps to a card
      const card = cards[cardIdx] || cards[cards.length - 1];

      // Check if any team has completed this station
      const completedByAny = teams.some(t => t.completed[line].includes(stn.id));
      const completedByCurrent = teams[currentTeamIdx]?.completed[line].includes(stn.id);

      // Station group
      const g = document.createElementNS('http://www.w3.org/2000/svg','g');
      g.setAttribute('cursor', completedByCurrent ? 'default' : 'pointer');
      if (!completedByCurrent) {
        g.addEventListener('click', () => openCard(line, stn, card));
      }

      // Outer ring
      const outer = document.createElementNS('http://www.w3.org/2000/svg','circle');
      outer.setAttribute('cx', stn.x); outer.setAttribute('cy', stn.y);
      outer.setAttribute('r', stn.isEnd ? '14' : '10');
      outer.setAttribute('fill', completedByCurrent ? color : 'white');
      outer.setAttribute('stroke', color);
      outer.setAttribute('stroke-width', stn.isEnd ? '3' : '2.5');
      outer.setAttribute('opacity', completedByCurrent ? '1' : '0.9');
      g.appendChild(outer);

      // Inner dot
      if (!completedByCurrent) {
        const inner = document.createElementNS('http://www.w3.org/2000/svg','circle');
        inner.setAttribute('cx', stn.x); inner.setAttribute('cy', stn.y);
        inner.setAttribute('r', '4');
        inner.setAttribute('fill', color);
        g.appendChild(inner);
      } else {
        // Checkmark
        const check = document.createElementNS('http://www.w3.org/2000/svg','text');
        check.setAttribute('x', stn.x); check.setAttribute('y', stn.y + 5);
        check.setAttribute('text-anchor','middle');
        check.setAttribute('font-size','12');
        check.setAttribute('fill','white');
        check.textContent = 'âœ“';
        g.appendChild(check);
      }

      // Team markers (small dots above station showing which teams visited)
      const visitingTeams = teams.filter(t => t.completed[line].includes(stn.id));
      visitingTeams.forEach((t, ti) => {
        const dot = document.createElementNS('http://www.w3.org/2000/svg','circle');
        dot.setAttribute('cx', stn.x - 8 + ti * 9);
        dot.setAttribute('cy', stn.y - 18);
        dot.setAttribute('r', '4');
        dot.setAttribute('fill', t.color);
        dot.setAttribute('stroke','white');
        dot.setAttribute('stroke-width','1.5');
        g.appendChild(dot);
      });

      // END label
      if (stn.isEnd) {
        const endLabel = document.createElementNS('http://www.w3.org/2000/svg','text');
        endLabel.setAttribute('x', stn.x + 20); endLabel.setAttribute('y', stn.y + 4);
        endLabel.setAttribute('font-family','Space Mono, monospace');
        endLabel.setAttribute('font-size','9');
        endLabel.setAttribute('font-weight','700');
        endLabel.setAttribute('letter-spacing','2');
        endLabel.setAttribute('fill', color);
        endLabel.textContent = 'END';
        g.appendChild(endLabel);
      }

      // Hover pulse (only for uncompleted)
      if (!completedByCurrent) {
        const pulse = document.createElementNS('http://www.w3.org/2000/svg','circle');
        pulse.setAttribute('cx', stn.x); pulse.setAttribute('cy', stn.y);
        pulse.setAttribute('r', '16');
        pulse.setAttribute('fill', color);
        pulse.setAttribute('opacity','0');
        pulse.setAttribute('class','station-pulse');
        g.setAttribute('data-pulse', '');
        g.addEventListener('mouseenter', () => { pulse.setAttribute('opacity','0.15'); });
        g.addEventListener('mouseleave', () => { pulse.setAttribute('opacity','0'); });
        g.insertBefore(pulse, g.firstChild);
      }

      svg.appendChild(g);
    });
  });

  // LINE labels on the left
  [1,2,3].forEach(line => {
    const firstStn = STATIONS[line][0];
    const color = LINES[line].color;
    const label = document.createElementNS('http://www.w3.org/2000/svg','text');
    label.setAttribute('x', firstStn.x - 40);
    label.setAttribute('y', firstStn.y + 4);
    label.setAttribute('text-anchor','middle');
    label.setAttribute('font-family','Space Mono, monospace');
    label.setAttribute('font-size','9');
    label.setAttribute('font-weight','700');
    label.setAttribute('letter-spacing','1');
    label.setAttribute('fill', color);
    label.textContent = `L${line}`;
    svg.appendChild(label);
  });
}

// â”€â”€ CARD LOGIC â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openCard(line, station, card) {
  activeStation = { line, station };
  activeCard = card;

  const color = LINES[line].color;

  document.getElementById('modal-line-tag').textContent = LINES[line].label;
  document.getElementById('modal-line-tag').style.background = color;
  document.getElementById('modal-station-label').textContent = `Station ${station.label}`;
  document.getElementById('modal-question').textContent = card.q;
  document.getElementById('modal-concept').textContent = card.concept;
  document.getElementById('modal-concept').style.background = color + '18';
  document.getElementById('modal-concept').style.color = color;
  document.getElementById('modal-goal').textContent = card.goal;
  document.getElementById('modal-done-btn').style.background = color;

  document.getElementById('card-modal').classList.add('open');
}

function closeCard() {
  document.getElementById('card-modal').classList.remove('open');
  activeStation = null;
  activeCard = null;
}

function completeStation() {
  if (!activeStation) return;
  const { line, station } = activeStation;
  const team = teams[currentTeamIdx];

  if (!team.completed[line].includes(station.id)) {
    team.completed[line].push(station.id);
    team.totalAnswered++;
  }

  closeCard();
  renderBoard();
  renderSidebar();
  showToast(`âœ“ ${team.name} answered a card!`);

  // Check win condition (all stations on at least one line completed)
  const allStationsCount = Object.values(STATIONS).reduce((a,b) => a + b.length, 0);
  const teamTotal = Object.values(team.completed).reduce((a,b) => a + b.length, 0);
  if (teamTotal >= allStationsCount) {
    setTimeout(() => {
      document.getElementById('winner-name').textContent = team.name;
      document.getElementById('winner-name').style.color = team.color;
      showScreen('winner');
    }, 800);
  }
}

function nextTurn() {
  currentTeamIdx = (currentTeamIdx + 1) % teams.length;
  updateTurnDisplay();
  renderSidebar();
  renderBoard();
  showToast(`Now it's ${teams[currentTeamIdx].name}'s turn`);
}

function updateTurnDisplay() {
  const team = teams[currentTeamIdx];
  if (!team) return;
  document.getElementById('turn-name').textContent = team.name;
  document.getElementById('turn-dot').style.background = team.color;
}

function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2500);
}

// â”€â”€ BOOT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.addEventListener('DOMContentLoaded', () => {
  showScreen('intro');
});
</script>
</body>
</html>
